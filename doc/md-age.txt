*md-age.txt*  Transparent age encryption for markdown files

Author:  Danny O'Brien <danny@spesh.com>
License: AGPL-3.0-or-later

INTRODUCTION                                    *md-age*

md-age-vim provides transparent encryption and decryption of markdown files
using age (https://age-encryption.org/). Files are automatically decrypted
when opened and encrypted when saved, based on YAML frontmatter configuration.

CONFIGURATION                                   *md-age-config*

                                                *g:md_age_identity*
g:md_age_identity~
    Required. Command-line arguments for age identity.
    Examples: >
        let g:md_age_identity = '-i ~/.age/identity.txt'
        let g:md_age_identity = '-j'  " for age plugins
<
                                                *g:md_age_command*
g:md_age_command~
    Optional. The age command to use. Default: 'age'
    Example: >
        let g:md_age_command = 'rage'
<
                                                *g:md_age_default_recipients*
g:md_age_default_recipients~
    Optional. Default recipients for |:MdAgeInit| template.
    Can be a string or list. Example: >
        let g:md_age_default_recipients = 'age1ql3z7...'
        let g:md_age_default_recipients = ['age1...', '~/.age/backup.pub']
<
FRONTMATTER FORMAT                              *md-age-frontmatter*

Enable encryption by adding these fields to YAML frontmatter: >

    ---
    title: My Document
    age-encrypt: yes
    age-recipients:
      - age1ql3z7hjy54pw...
      - ~/.age/recipients.txt
      - ssh-ed25519 AAAA...
    ---
<
Recipients can be:
- age public keys (starting with 'age1')
- SSH public keys (starting with 'ssh-')
- Paths to recipient files (anything else, uses -R flag)

COMMANDS                                        *md-age-commands*

                                                *:MdAgeInit*
:MdAgeInit          Insert frontmatter template at top of buffer.

                                                *:MdAgeStatus*
:MdAgeStatus        Show current encryption status and recipients.

GIT INTEGRATION                                 *md-age-git*

The `md-age` command-line tool (in bin/) supports git smudge/clean filters
for transparent encryption in repositories.

                                                *md-age-git-setup*
Setup: >
    md-age git init                    " configure filters and .gitattributes
    md-age git config add -i ~/.age/key.txt
<
                                                *md-age-git-commands*
Git subcommands:~
    md-age git init              Set up filters and .gitattributes
    md-age git config add -i     Add identity for decryption
    md-age git config list       Show configured identities
    md-age git config remove -i  Remove identity
    md-age git clean             Encrypt filter (called by git)
    md-age git smudge            Decrypt filter (called by git)

Files with `age-encrypt: yes` in frontmatter are encrypted on commit and
decrypted on checkout. Other markdown files pass through unchanged.

KNOWN LIMITATIONS                               *md-age-limitations*

Passphrase-protected identities are not currently supported when using
`system()` calls, as there is no TTY available for the passphrase prompt.

Workarounds:
- Use an unencrypted age identity file
- Use age plugins that handle auth differently (e.g., age-plugin-yubikey)
- Use the upcoming `age-plugin-batchpass` (expected in a future age release)
  which reads passphrases from environment variables or file descriptors

Native age keys are recommended for scripted/non-interactive use. You can
encrypt directly to the private key: >
    age-keygen -o key.txt
    let g:md_age_identity = '-i ~/key.txt'
<
Or use an environment variable: >
    export AGE_SECRET=$(age-keygen)
    let g:md_age_identity = '-i <(echo "$AGE_SECRET")'
<

ERROR HANDLING                                  *md-age-errors*

If decryption fails (wrong key, corrupted file):
- Buffer is set to read-only
- Encrypted content remains visible
- Error message is displayed

If encryption fails:
- Save is aborted
- Error message is displayed

 vim:tw=78:ts=8:ft=help:norl:
